---
layout: single
title: Руссификация Movable Type 4.1
date: 2008-03-24 14:59:10 +03:00
comments: true
categories: [Movable Type]
---

[Продолжаем](/2008/03/20/movabletypes-fastcgi/) работу с Movable Type. Руссификацию пришлось делать в два захода. На первом заходе, после предварительного гугленья, был применен [рецепт](https://blog.lexa.ru/2008/01/26/movabletype_41_i_russkij_jazik.html) для руссификации [Movable Type](https://movabletype.org/) версии 4 от [Алексея Тутубалина](https://blog.lexa.ru/) с небольшими изменениями:

- приложен патч [patch-monday-mt41.gz](https://blog.lexa.ru/files/patch-monday-mt41.gz) для того чтобы в календаре неделя начиналась с понедельника
- приложен патч [patch-dirify.gz](https://blog.lexa.ru/files/patch-dirify.gz) для конвертации русских символов в заголовках статей в латиницу при генерации имени файла
- приложен патч [patch-nofollow.gz](https://blog.lexa.ru/files/patch-nofollow.gz) для поддержки тэга <noindex> для Яндекса

Патч [patch-rudate.gz](https://blog.lexa.ru/files/patch-rudate.gz) не прикладывал, но посмотрев в него, сделал свой. Вместо того, чтобы использовать итальянский формат, добавил русский в список форматов, изменив lib/MT/Util.pm и tmpl/cms/cfg\_entry.tmpl. Изменен также и формат отображения — вместо _24.03.2008_ будет _Март, 24 2008_. Патч [patch-rudate41.gz](/files/patch-rudate41.gz) прилагается.

Далее последовал наиболее нудный этап — перевод шаблонов. Разбор со [скриптом Алексея Тутубалина](https://blog.lexa.ru/2007/09/23/eksport_templejtov_movable_type_variant_2.html) для экспорта/импорта шаблонов я оставил на потом (этот скрипт был сделан до выхода версии 4.1 и неизвестно как он с ней работает, к тому же он требует установки плугина [TemplateInstaller](https://mt-hacks.com/templateinstaller.html)), поэтому шаблоны перевел вручную через админку Movable Type. Хотя шаблонов около полусотни, но сами они немногословны и переводить можно не все, а только те, которые реально используются. Поэтому первые результаты появился сравнительно быстро, но в процессе перевода увлекся файн-тюнингом оформления и внес слишком много изменений в шаблоны, так что собравшись создавать блог для своей SO, обнаружил что мне надо либо вычищать свое оформление, либо возвращаться к стандартным шаблонам и переводить их опять с нуля.

Немного поразмышляв, решил выбрать другой подход. В Movable Type есть в наличии полная инфраструктура для локализации базирующаяся на perl’овом [Locale::Maketext](https://search.cpan.org/~toddr/Locale-Maketext/) и [документация рекомендуют](https://github.com/movabletype/Documentation/wiki/Translation-and-Localization) именно этот подход. Проект [movable-type.ru](https://movable-type.ru/) после выхода версии 4.0 в августе 2007 вроде бы огранизовал [коллективную попытку](https://movable-type.ru/2007/08/localization-mt4.php) сделать русский перевод и месяц назад даже [заявлена](https://movable-type.ru/forums/viewtopic.php?id=66) 90% готовность, но реальных результатов пока не наблюдается. Конечно объем текста в более чем 4 тысячи строк на первый взгляд выглядит ужасающе, но ничто не мешает переводить текст по частям, например, для начала только те строки, которые используются в самих блогах, а не в админке.

За пару вечеров у меня был готов перевод следующих компонентов используемых в опубликованном блоге:

- шаблоны default\_templates/\*.mtml которые используются при генерации шаблонов нового блога
- шаблоны plugins/WidgetManager/default\_widgets/\*.mtml для widget’ов 
- php-скрипты динамической публикации

Все это занимает где-то чуть более 600 строк ( [ru-published-only.pm](/files/ru-published-only.pm)). Данный файл необходимо переименовать в ru.pm и положить в lib/MT/L10N/, при этом русский язык автоматически станет доступен для выбора в профиле пользователя. Стоит иметь в виду, что перевод фраз в шаблонах на русский производится в момент генерации шаблонов и только если у пользователя выбран русский язык в профиле. Если блог уже создан, то можно перегенерировать шаблоны заново, зайдя в своем блоге через меню «Design» → «Manage Templates» → «Refresh Blog Templates». При перегенерации большинство новых руссифицированных шаблонов будут иметь русские имена и у меня лично слетели Archive Maps и наборы widget’ов. Нужно будет их пересоздать, предварительно удалив все старые шаблоны и widget’ы.

Все остальное пока находится в процессе перевода, хотя наиболее часто используемые части админки уже переведены практически полностью (можно скачать [Файл перевода](/files/ru-20080402.pm)). В качестве основы для этого файла взят es.pm, поэтому непереведенные строки будут по испански. Также добавлен скрипт [mt\_ru.js](/files/mt_ru.js) который содержит локализованные строки для JavaScript и локализованную таблицу для динамической dirtif’икации заголовков в имена файлов. Файл стилей [styles\_ru.css](/files/styles_ru.css) содержит одну строчку — модификация ширины колонок в виджете календаря.

По мере дальнейшего перевода я планирую выкладывать обновленную версию файла [ru.pm](/files/ru-20080402.pm), следите за обновлениями.
